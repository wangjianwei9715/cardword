<template>
	<view class="container">
		<view class="navigateBox" :style="{ top: deleteHeight + 'px' }">
			<view class="navigateBackBox" @click="onClickBack">
				<image class="navigateBack" src="@/static/information/live_back.png"></image>
			</view>
			<view class="navigateShareBox" @click="onClickShare">
				<image class="navigateShare" src="@/static/information/live_share.png"></image>
			</view>
		</view>
		<view :style="'width: ' + windowWidth + 'px; height: ' + boxStyle.height + 'px;'">

			<list @loadmore="getData" @scroll="scrolls" :loadmoreoffset="wHeight * 1" :show-scrollbar="false" ref="listBox"
				:pagingEnabled="true" :scrollable="true">
				<cell v-for="(item, i) in dataList" :key="i">
					<div :style="'width: ' + windowWidth + 'px; height: ' + boxStyle.height + 'px;'" @disappear="stop()">
						<view v-if="Math.abs(k - i) <= 1">
							<view class="root">
								<video :ref="'item' + i" :id="item.articleCode" :loop="true" :src="item.video_url"
									:muted="item.isplay" @play="playIngs(i)" :enable-progress-gesture="false"
									:page-gesture="false" :controls="false" :http-cache="true" :show-loading="false"
									:show-fullscreen-btn="false" :show-center-play-btn="false" :style="boxStyle"
									:object-fit="item.show_way" @timeupdate="timeupdate($event, i)"></video>
								<!-- <image
								v-if="!item.playIng"
									:src="item.video_url+'?x-oss-process=video/snapshot,t_100,f_jpg'" 
									:mode="mode"
									:style="'width: '+ windowWidth +'px; height: '+ (wHeight - deleteHeight) +'px; position: absolute;'"
								></image> -->
							</view>
							<!-- Ëøô‰∏™ÊòØÊöÇÂÅúÊó∂Âá∫Áé∞ÁöÑÂõæÊ†á -->
							<view class="videoHover" @click="tapVideoHover(item)" :style="boxStyle">
								<image v-if="item.state == 'pause'" class="playState" src="@/static/information/play.png">
								</image>
							</view>
							<!-- ÊúÄÂ∫ï‰∏ãÁöÑÊñáÂ≠óÈÉ®ÂàÜ -->
							<view class="content" v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == false"
								@click="onDetail">
								<view class="descBox">
									<image style="width:50rpx;height:50rpx;border-radius:500px;overflow: hidden;"
										:src="decodeURIComponent(item.author_logo)" mode="aspectFill" />
									<text class="descAuthor">{{ item.author }}</text>
								</view>
								<text class="userName">{{ item.title }}</text><!-- i={{i}} -->
								<text class="words">{{ replaceText(decodeURIComponent(item.content)) }}</text><!-- k={{k}} -->
							</view>
						</view>
					</div>
				</cell>
			</list>
		</view>

		<!-- tabbar -->
		<nTabbar :data="dataList[k] ? dataList[k] : {}" :commentNum="dataList[k] ? dataList[k].comment : 0"
			:deleteHeight="deleteHeight" @comment.prevent="onDetail"></nTabbar>
		<!-- 1.Ê≥®ÊÑèÔºöËøõÂ∫¶Êù°ËøôÁ±ªÊãñÊãΩÁöÑ‰∏úË•ø‰∏çËÉΩÊîæËøõblock\cellËøô‰∫õÂæ™ÁéØ‰Ωì‰∏≠ÁöÑÔºåË¶Å‰∏çÁÑ∂touchmoveÊñπÊ≥ï‰ºöÊçïÊçâÊúâËØØ -->
		<view v-if="showPlan">
			<view v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == true"
				:style="'position: absolute; bottom: ' + (proBarBottom + 10) + 'px; left: ' + (windowWidth * 2 - this.windowWidth * 1.35) / 2 + 'px;'">
				<text style="font-size: 22px; font-weight: bold; color: #F1F1F1;">{{ changeTime }} / {{ videoTimes }}</text>
			</view>
			<view v-if="isDragging == false" @touchmove="touchmove" @touchend="touchend" @touchstart="touchstart"
				style="position: fixed; left: 0;z-index:9" :style="{ bottom: proBarBottom + 'px' }">
				<!-- 1.Ëøô‰∏ÄÊ≠•ÂøÖÈ°ªÂä†Ôºå‰∏∫‰∫ÜÈÄÇÈÖç‰ΩéÁ´ØÊú∫Âûã -->
				<text :style="'width: ' + windowWidth + 'px; opacity: 0;'">.</text>
				<!-- 2.ËøôÊòØÊú™Âä†ËΩΩÁöÑÊó∂ÁöÑÂè≥ËæπÁöÑÁÅ∞Ëâ≤ÈÉ®ÂàÜ -->
				<view
					:style="'width: ' + windowWidth + 'px; height: 4upx; background-color: #C8C7CC; position: absolute; bottom: ' + ProgressBarBottom + 'upx; opacity: ' + ProgressBarOpacity + ';'">
				</view>
				<!-- 4.Ê≥®ÊÑèÔºöisShowProgressBarTime Âä†ÂÖ•‰∫ÜËøîÂõûÊï∞ÊçÆ‰∏≠ -->
				<view v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == false"
					:style="'width: ' + (currentPosition) + 'px; height: 4upx; background-color: #FFFFFF; position: absolute; bottom: ' + ProgressBarBottom + 'upx; left: 0; opacity: ' + (ProgressBarOpacity - 0.1) + ';'">
				</view>
				<view v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == true"
					:style="'width: ' + (currentPositions) + 'px; height: 8upx; background-color: #FFFFFF; position: absolute; bottom: ' + ProgressBarBottom + 'upx; left: 0; opacity: ' + (ProgressBarOpacity + 0.05) + ';'">
				</view>
				<view v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == false"
					:style="'width: 4px; height: 4px; background-color: #FFFFFF; border-radius: 10px; position: absolute; bottom: ' + (ProgressBarBottom - 2) + 'upx; left: ' + (currentPosition) + 'px; opacity: ' + ProgressBarOpacity + ';'">
				</view>
				<view v-if="dataList.length !== 0 && dataList[k].isShowProgressBarTime == true"
					:style="'width: ' + dotWidth + 'px; height: ' + dotWidth + 'px; background-color: #FFFFFF; border-radius: 10px; position: absolute; bottom: ' + (ProgressBarBottom - 5) + 'upx; left: ' + (currentPositions - 5) + 'px; opacity: ' + ProgressBarOpacity + ';'">
				</view>
			</view>
		</view>
		<!-- ÂàÜ‰∫´ -->
		<nvueShare :visible.sync='shareShow' :shareData='shareData'></nvueShare>
		<!-- Â∫ïÈÉ®ËØ¶ÊÉÖ -->
		<view class="popup" :style="{ height: showDetail ? wHeight : 0 + 'px' }">
			<view class="popup-shadow" :style="{ height: showDetail ? wHeight : 0 + 'px' }" @click="onClosePopup"></view>
			<view class="popup-content" :style="{ height: showDetail ? (boxStyle.height - 200) : 0 + 'px' }">
				<view class="vd-user" v-if="dataList[k]">
					<image class="vd-avatar" :src="decodeURIComponent(dataList[k].author_logo)" />
					<view>
						<text class="vd-name">{{ dataList[k].author }}</text>
						<text class="vd-time">ÂèëÂ∏É‰∫é{{ timeFormat(dataList[k].active_at) }}</text>
					</view>
				</view>
				<list ref="comList" v-if="showDetail" :show-scrollbar="false" :pagingEnabled="false" :scrollable="true"
					@loadmore="getMoreComment" :loadmoreoffset="1">
					<cell>
						<vdetail style="padding-top: 20rpx;" :articleData="dataList[k] ? dataList[k] : {}" @reply="onReply">
							<nTabbar v-if="showDetail" :data="dataList[k] ? dataList[k] : {}"
								:commentNum="dataList[k] ? dataList[k].comment : 0" :deleteHeight="deleteHeight" :detail="true"
								@comment="onReply"></nTabbar>
						</vdetail>
					</cell>
				</list>
			</view>
		</view>

		<view class="upslide" :class="{ 'upslide-show': upslideShow }">
			<image class="upslide-pic" src="@/static/information/more_bg.png" />
			<image class="upslide-hand" src="@/static/information/more_icon.png" />
			<text class="upslide-name">‰∏äÊªëÊü•ÁúãÊõ¥Â§öËßÜÈ¢ë</text>
		</view>
		<!-- ËæìÂÖ•Ê°Ü -->
		<nTextarea :focus="chatData.focus" :replyName="chatData.replyName" @chatConfirm="onChatConfirm" @blur="onBlur">
		</nTextarea>
	</view>
</template>
<script>
import nvueShare from "../live/components/nvueShare.nvue";
import nTabbar from "./components/nTabbar.nvue";
import nTextarea from "./components/nTextarea.nvue";
import vdetail from "./components/vdetail.nvue";
const app = getApp().globalData.app;
const shareData = {
	shareUrl: "",
	title: "",
	summary: "",
	thumb: ""
};
const chat = {
	replyId: 0,
	replyName: '',
	fatherId: 0,
	focus: false
}
export default {
	data() {
		return {
			code: '',
			shareShow: false,
			shareData: { ...shareData },
			isFetchEnd: false,
			proBarBottom: 0,
			chatData: { ...chat },
			showDetail: false,
			showPlan: true,
			resetLoadmored: false,
			searchQ: '',
			vType: 100,
			//‰∏ãÈù¢ÊâìüåüÂè∑ÁöÑÊòØÂøÖÈ°ªË¶ÅÁöÑÂü∫Á°ÄÂ≠óÊÆµ
			//‰∏ãÈù¢ÊâìüíóÂè∑ÁöÑÊòØÊã•ÊúâÊªëÂä®Êù°ÁöÑÂøÖÈ°ªÂ≠óÊÆµ
			dataList: [],//Áî®‰∫éÊï∞ÊçÆÂæ™ÁéØÁöÑÂàóË°®üåüüíó
			wHeight: 0,//Ëé∑ÂèñÁöÑÂ±èÂπïÈ´òÂ∫¶üåüüíó
			boxStyle: {//ËßÜÈ¢ëÔºåÂõæÁâáÂ∞ÅÈù¢Ê†∑Âºèüåüüíó
				'height': 0,
				'width': 0,
			},
			k: 0,//ÈªòËÆ§‰∏∫0üåüüíó
			isDragging: false,//false‰ª£Ë°®ÂÅúÊ≠¢ÊªëÂä®üåüüíó
			windowWidth: 0,//Ëé∑ÂèñÂ±èÂπïÂÆΩÂ∫¶üåüüíó
			windowHeight: 0,
			platform: '',//Áî®‰∫éËé∑ÂèñÊìç‰ΩúÁ≥ªÁªüÔºöios„ÄÅandroidüåüüíó
			playIng: false,//Áî®‰∫éËßÜÈ¢ëÂàùÂßãÂåñÊó∂ÊòØÂê¶Êí≠ÊîæÔºåÈªòËÆ§‰∏çÊí≠Êîæüåüüíó
			videoTime: '',//ËßÜÈ¢ëÊÄªÊó∂ÈïøÔºåËøô‰∏™‰∏ªË¶ÅÁî®Êù•Êà™ÂèñÊó∂Èó¥Êï∞ÂÄºüíó
			videoTimes: '',//ËßÜÈ¢ëÊó∂ÈïøÔºåÁî®Ëøô‰∏™Êù•Ëé∑ÂèñÊó∂Èó¥ÂÄºÔºå‰æãÂ¶ÇÔºö00:30Ëøô‰∏™Êó∂Èó¥ÂÄºüíó
			changeTime: '',//ÊòæÁ§∫ÊªëÂä®ËøõÂ∫¶Êù°Êó∂ÂèòÂåñÁöÑÊó∂Èó¥üíó
			currenttimes: 0,//ÂΩìÂâçÊó∂Èó¥üíó
			isShowProgressBarTime: false,//ÊòØÂê¶ÊãñÂä®ËøõÂ∫¶Êù°ÔºåÂ¶ÇÊûúÊãñÂä®ÔºàtrueÔºâÂàôÊòæÁ§∫ËøõÂ∫¶Êù°Êó∂Èó¥ÔºåÂê¶Âàô‰∏çÊòæÁ§∫ÔºàfalseÔºâ„Äê1.0.4Â∑≤Â∫üÂºÉÔºå‰ΩÜÊòØÊÑèÊÄùÈúÄË¶ÅËÆ∞‰Ωè„Äë
			ProgressBarOpacity: 0.7,//ËøõÂ∫¶Êù°‰∏çÊãñÂä®Êó∂ÁöÑÈªòËÆ§ÂÄºÔºåÂ∞±ÊòØÈÄèÊòéÁöÑüíó
			dotWidth: 0,//Êí≠ÊîæÁöÑÂ∞èÂúÜÁÇπÔºåÈªòËÆ§Ê≤°Êúâüíó
			deleteHeight: 0,//ÊµãËØïÈ´òÂ∫¶üåüüíó
			percent: 0,//ÁôæÂàÜÂ∞èÊï∞üíó
			currentPosition: 0,//ÊªëÂùóÂΩìÂâç‰ΩçÁΩÆüíó//2.0Â∑≤ÂºÉÁî®ÔºåÁé∞Â∑≤Áî®‰∫éÂêéÁ´ØÂèÇÊï∞
			currentPositions: 0,//ÊªëÂùóÂΩìÂâç‰ΩçÁΩÆÁöÑÂâØÊú¨üíó//2.0Â∑≤ÂºÉÁî®ÔºåÁé∞Â∑≤Áî®‰∫éÂêéÁ´ØÂèÇÊï∞
			newTime: 0,//Ë∑üÊâãÊªëÂä®ÂêéÁöÑÊúÄÊñ∞Êó∂Èó¥üíó
			timeNumber: 0,//üåüüíó
			ProgressBarBottom: 20,//ËøõÂ∫¶Êù°Á¶ªÂ∫ïÈÉ®ÁöÑË∑ùÁ¶ªüíó
			object_fit: 'fill',//ËßÜÈ¢ëÊ†∑ÂºèÈªòËÆ§ÂåÖÂê´üåüüíó
			mode: 'aspectFit',//ÂõæÁâáÂ∞ÅÈù¢Ê†∑Âºèüåüüíó
			timeout: "",//üåüÁî®Êù•ÈòªÊ≠¢ setTimeout()ÊñπÊ≥ï
			voice: "",//üåüÁî®Êù•ÈòªÊ≠¢ setTimeout()ÊñπÊ≥ï
			oldVideo: "",
			timers: "",
			upslideShow: false
		}
	},
	components: {
		nvueShare,
		nTabbar,
		nTextarea,
		vdetail
	},
	watch: {
		async k(k, old_k) {//ÁõëÂê¨ k ÂÄºÁöÑÂèòÂåñÔºåÂèØ‰ª•ÊéßÂà∂ËßÜÈ¢ëÁöÑÊí≠Êîæ‰∏éÊöÇÂÅú
			this.dataList[old_k].state = 'stop'
			this.dataList[old_k].isplay = true
			this.dataList[k].isplay = false
			uni.createVideoContext(this.dataList[k].articleCode, this).seek(0)
			uni.createVideoContext(this.dataList[k].articleCode, this).play();
			uni.createVideoContext(this.dataList[old_k].articleCode, this).pause()
			console.log('Â∑≤ÁªèÊöÇÂÅú --> Á¨¨' + (old_k + 1) + '‰∏™ËßÜÈ¢ëÔΩû')//ÊèêÁ§∫

			//„Äê2.0ÁâàÊú¨Êõ¥Êñ∞ÂÜÖÂÆπ„Äë- start
			var p = k + 1
			await setTimeout(async () => {
				uni.createVideoContext(this.dataList[p].articleCode, this).play()
				setTimeout(() => {
					uni.createVideoContext(this.dataList[p].articleCode, this).pause()
					console.log('È¢ÑÂä†ËΩΩÁ¨¨' + (p + 1) + '‰∏™ËßÜÈ¢ëÔºö' + this.dataList[p].articleCode)
				}, 100)
			}, 20)
			//„Äê2.0ÁâàÊú¨Êõ¥Êñ∞ÂÜÖÂÆπ„Äë- end
			//„ÄêÊ≠§Â§ÑÂ§ÑÁêÜËøõÂ∫¶Êù°Âç°‰ΩèÁöÑÈóÆÈ¢ò„Äë
			if (uni.getSystemInfoSync().platform !== 'ios') {
				await setTimeout(() => {
					uni.createVideoContext(this.dataList[k].articleCode, this).pause()
					uni.createVideoContext(this.dataList[k].articleCode, this).play()
				}, 100)
			}
		}
	},
	onShow() {
		console.log('ÂõûÂà∞ÂâçÂè∞');
		if (this.dataList.length !== 0) {
			this.dataList[this.k].state = 'play';
			uni.createVideoContext(this.dataList[this.k].articleCode, this).play()
		}
	},
	onHide() {
		this.dataList[this.k].state = 'pause';//ÁïåÈù¢ÈöêËóè‰πüË¶ÅÂÅúÊ≠¢Êí≠ÊîæËßÜÈ¢ë
		uni.createVideoContext(this.dataList[this.k].articleCode, this).pause();//ÊöÇÂÅú‰ª•ÂêéÁªßÁª≠Êí≠Êîæ
		console.log('Âà∞ÂêéÂè∞');
	},
	onLoad(query) {
		this.upslideInit()
		this.code = query.code;
		this.vType = query.type;
		this.searchQ = query.q || '';
		this.platform = uni.getSystemInfoSync().platform
		var model = uni.getSystemInfoSync().model
		if (this.platform == 'ios' && (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !== 'iPhone8')) {
			this.deleteHeight = 32//Êúâ tabbarÁöÑ ‰øÆÊîπËøôÈáåÂèØ‰ª•ÊîπÂèòËßÜÈ¢ëÈ´òÂ∫¶
		} else {
			this.deleteHeight = 0
		}
		this.windowWidth = uni.getSystemInfoSync().screenWidth//Ëé∑ÂèñÂ±èÂπïÂÆΩÂ∫¶
		this.boxStyle.width = this.windowWidth + 'px'//ÁªôÂÆΩÂ∫¶Âä†px
		this.wHeight = uni.getSystemInfoSync().screenHeight;//Ëé∑ÂèñÂ±èÂπïÈ´òÂ∫¶
		this.proBarBottom = uni.upx2px(100) + this.deleteHeight
		this.boxStyle.height = this.wHeight - this.deleteHeight - uni.upx2px(124);//ÊîπÂèòËßÜÈ¢ëÈ´òÂ∫¶
		this.get()//Ëøô‰∏ÄÊ≠•ÔºåÂä†ËΩΩËßÜÈ¢ëÊï∞ÊçÆ

		uni.$on("informationChange", (res) => {
			if (res && res.articleCode) {
				let findItem = this.dataList.find((item) => {
					return item.articleCode == res.articleCode;
				});
				if (findItem) {
					if (res.isLikes) {
						findItem.isLikes = res.isLikes;
						findItem.likes = res.likes;
					} else {
						findItem.favorite = res.favorite;
						findItem.isFavorite = res.isFavorite;
					}
					findItem.comment = res.comment
				}
			}
		});
		uni.$on('resetLoadmore', () => {
			if (this.resetLoadmored) {
				this.$refs["comList"].resetLoadmore();
			}
		})
	},
	onReady() {
	},
	onUnload() {
		uni.$off('resetLoadmore');
	},
	methods: {
		upslideInit() {
			this.upslideShow = uni.getStorageSync('upslideShow') !== false;
			console.log('d-', uni.getStorageSync('upslideShow') !== false);
			if (this.upslideShow) {
				uni.setStorageSync('upslideShow', false);
				setTimeout(() => {
					this.upslideShow = false;
				}, 3000)
			}
		},
		replaceText(text) {
			return text.replace(/\<p\>/g, '').replace(/\<\/p\>/g, '')
		},
		onClickBack() {
			uni.navigateBack({ delta: 1 })
		},
		onClickShare() {
			uni.$u.throttle(() => {
				this.shareData = {
					shareUrl: "share/h5/index.html#/pages/information/index?code=" + this.code,
					title: this.dataList[this.k].title,
					summary: this.dataList[this.k].title,
					thumb: decodeURIComponent(this.dataList[this.k].cover)
				};
				this.shareShow = true;
			}, 1000)
		},
		getData() {

		},
		touchstart(event) {
			this.dataList[this.k].isShowProgressBarTime = true //ÊòæÁ§∫Êó∂Èó¥Á∫ø
			this.ProgressBarOpacity = 1 //ËÆ©ÊªëÂùóÊòæÁ§∫Ëµ∑Êù•Êõ¥ÊòéÊòæ‰∏ÄÁÇπ
			this.dotWidth = 10 //ËÆ©ÁÇπÊòæÁ§∫Ëµ∑Êù•Êõ¥ÊòéÊòæ‰∏ÄÁÇπ
		},
		touchend() {//ÂΩìÊâãÊùæÂºÄÂêéÔºåË∑≥Âà∞ÊúÄÊñ∞Êó∂Èó¥
			uni.createVideoContext(this.dataList[this.k].articleCode, this).seek(this.newTime)
			if (this.dataList[this.k].state == 'pause') {
				this.dataList[this.k].state = 'play'
				uni.createVideoContext(this.dataList[this.k].articleCode, this).play()
			}
			this.dataList[this.k].isShowProgressBarTime = false //Ëß¶Êë∏ÁªìÊùüÂêéÔºåÈöêËóèÊó∂Èó¥Á∫ø
			this.ProgressBarOpacity = 0.5 //ÈöêËóèËµ∑Êù•ËøõÂ∫¶Êù°Ôºå‰∏çÈÇ£‰πàÊòéÊòæ‰∫Ü
			this.dotWidth = 0 //ÈöêËóèËµ∑Êù•ËøõÂ∫¶Êù°Ôºå‰∏çÈÇ£‰πàÊòéÊòæ‰∫Ü
		},
		touchmove(event) {//ÂΩìÊâãÁßªÂä®ÊªëÂùóÊó∂ÔºåËÆ°ÁÆó‰ΩçÁΩÆ„ÄÅÁôæÂàÜÂ∞èÊï∞„ÄÅÊñ∞ÁöÑÊó∂Èó¥
			var msg = []
			if (this.videoTime !== '') {
				msg = this.videoTime.split(':')
			}
			var timeNumber = Number(msg[0]) * 60 + Number(msg[1])
			this.currentPositions = event.changedTouches[0].screenX
			this.percent = this.currentPositions / this.windowWidth
			this.newTime = this.percent * timeNumber
			this.currenttimes = parseInt(this.newTime)
			let theTime = this.newTime
			let middle = 0;// ÂàÜ
			if (theTime > 60) {
				middle = parseInt(theTime / 60);
				theTime = parseInt(theTime % 60);
			}
			this.changeTime = `${Math.round(middle) > 9 ? Math.round(middle) : '0' + Math.round(middle)}:${Math.round(theTime) > 9 ? Math.round(theTime) : '0' + Math.round(theTime)}`
		},
		timeupdate(event, index) {//ËÆ°ÁÆóÊªëÂùóÂΩìÂâç‰ΩçÁΩÆÔºåËÆ°ÁÆóÂΩìÂâçÁôæÂàÜÂ∞èÊï∞
			if (index == this.k) {
				var currenttime = event.detail.currentTime
				this.timeNumber = Math.round(event.detail.duration)
				this.getTime()
				this.percent = currenttime / this.timeNumber
				this.currentPosition = this.windowWidth * this.percent
				let theTime = currenttime
				let middle = 0;// ÂàÜ
				if (theTime > 60) {
					middle = parseInt(theTime / 60);
					theTime = parseInt(theTime % 60);
				}
				if (!this.dataList[this.k].isShowProgressBarTime) {
					this.changeTime = `${Math.round(middle) > 9 ? Math.round(middle) : '0' + Math.round(middle)}:${Math.round(theTime) > 9 ? Math.round(theTime) : '0' + Math.round(theTime)}`
				}
			}
		},
		getTime() {//ÂæóÂà∞Êó∂Èó¥ÂáΩÊï∞
			this.videoTime = this.formatSeconds(this.timeNumber);
			var msg = []
			if (this.videoTime !== '') {
				msg = this.videoTime.split(':')
			}
			this.videoTimes = `${msg[0] > 9 ? msg[0] : '0' + msg[0]}:${msg[1] > 9 ? msg[1] : '0' + msg[1]}`;
		},
		formatSeconds(value) {//Ëé∑ÂèñÊó∂Èó¥ÂáΩÊï∞
			let theTime = parseInt(value);// Áßí
			let middle = 0;// ÂàÜ
			if (theTime > 60) {
				middle = parseInt(theTime / 60);
				theTime = parseInt(theTime % 60);
			}
			return `${middle > 9 ? middle : middle}:${theTime > 9 ? theTime : theTime}`;
		},
		playIngs(index) {

		},
		stop() {
			// console.log('stop')
		},
		scrolls(event) {
			// uni.$u.debounce(()=>{
			this.isDragging = event.isDragging
			if (!event.isDragging) {//isDraggingÔºöÂà§Êñ≠Áî®Êà∑ÊòØ‰∏çÊòØÂú®ÊªëÂä®ÔºåÊªëÂä®ÔºötrueÔºåÂÅúÊ≠¢ÊªëÂä®Ôºöfalse„ÄÇÊàë‰ª¨Ë¶ÅÁî®Êà∑ÂÅúÊ≠¢ÊªëÂä®Êó∂ÊâçÁªô k ËµãÂÄºÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÈÅøÂÖçÂæàÂ§öÈ∫ªÁÉ¶
				var i = Math.round(Math.abs(event.contentOffset.y) / (this.wHeight - this.deleteHeight - uni.upx2px(124) + 1))//ÂÖàÁî®ÁªùÂØπÂÄºÂèñÂá∫ÊªëÂä®ÁöÑË∑ùÁ¶ªÔºåÁÑ∂ÂêéÈô§‰ª•Â±èÂπïÈ´òÂ∫¶ÔºåÂèñ‰∏Ä‰∏™Êï¥ÔºåÂ∞±Áü•ÈÅì‰Ω†Áé∞Âú®ÊªëÂä®Âà∞Âì™‰∏Ä‰∏™ËßÜÈ¢ë‰∫Ü
				if (i !== this.k) {//ËøôÈáåÂä†Âà§Êñ≠ÊòØÂõ†‰∏∫Ëøô‰∏™ÊñπÊ≥ï‰ºöÊâßË°åÂæàÂ§öÊ¨°Ôºå‰ºöÈÄ†ÊàêÈáçÂ§çËØ∑Ê±ÇÔºåÊâÄ‰ª•ËøôÈáåÂÜô‰∏Ä‰∏™ÈôêÂà∂
					if (uni.getSystemInfoSync().platform == 'ios') {
						this.k = i//Âà§Êñ≠‰∫ÜÁî®Êà∑Ê≤°ÊúâÊªëÂä®ÔºåÁ°ÆËÆ§‰∫ÜÁî®Êà∑ÁöÑÁ°ÆÊòØÂú®ÁúãËøô‰∏™ËßÜÈ¢ëÔºåÁÑ∂ÂêéÂ∞±ËµãÂÄºÂï¶
						this.dataList[this.k].state = 'play'
						if (this.k == this.dataList.length - 1) {
							this.getMore()
						}
						console.log('Ê≠£Âú®Êí≠Êîæ --> Á¨¨' + (this.k + 1) + '‰∏™ËßÜÈ¢ëÔΩû')
					} else {
						clearTimeout(this.timers);
						this.timers = setTimeout(() => {
							this.k = i//Âà§Êñ≠‰∫ÜÁî®Êà∑Ê≤°ÊúâÊªëÂä®ÔºåÁ°ÆËÆ§‰∫ÜÁî®Êà∑ÁöÑÁ°ÆÊòØÂú®ÁúãËøô‰∏™ËßÜÈ¢ëÔºåÁÑ∂ÂêéÂ∞±ËµãÂÄºÂï¶
							this.dataList[this.k].state = 'play'
							if (this.k == this.dataList.length - 1) {
								this.getMore()
							}
							console.log('Ê≠£Âú®Êí≠Êîæ --> Á¨¨' + (this.k + 1) + '‰∏™ËßÜÈ¢ëÔΩû')
						}, 80)
					}
				}
			}
			// },500)
		},
		get() {
			app.http.Get(`dataApi/article/detail/${this.code}`, {}, (res) => {
				const data = [{ ...res.data, isShowProgressBarTime: false, state: 'play', isplay: false }]
				this.dataList = [...data]
				setTimeout(() => {
					uni.createVideoContext(this.dataList[0].articleCode, this).seek(0)
					uni.createVideoContext(this.dataList[0].articleCode, this).play()
				}, 200)
				this.getMore()
			})
		},
		getMore() {
			if (this.isFetchEnd) return;
			app.http.Get(`dataApi/article/video/detail/list/${this.dataList[this.k].articleCode}`, { fetchSize: 10, tp: this.vType, q: this.searchQ }, async (res) => {
				this.isFetchEnd = res.isFetchEnd;
				const list = await res.list.map((x) => {
					return { ...x, isShowProgressBarTime: false, state: 'stop', isplay: true }
				})
				var p = this.dataList.length;
				this.dataList = await [...this.dataList, ...list];
				setTimeout(() => {
					uni.createVideoContext(this.dataList[p].articleCode, this).play()
					setTimeout(() => {
						uni.createVideoContext(this.dataList[p].articleCode, this).seek(0)
						uni.createVideoContext(this.dataList[p].articleCode, this).pause()
						console.log('È¢ÑÂä†ËΩΩÁ¨¨' + (p + 1) + '‰∏™ËßÜÈ¢ëÔºö' + this.dataList[p].articleCode)
					}, 100)
				}, 50)
			})
		},
		//ÁÇπÂáªÊí≠Êîæ&&ÊöÇÂÅú
		tapVideoHover(item) {
			this.dataList[this.k].isShowProgressBarTime = false
			this.ProgressBarOpacity = 0.5
			this.dotWidth = 0
			if (item.state == 'play') {
				item.state = 'pause';
				uni.createVideoContext(this.dataList[this.k].articleCode, this).pause();
			} else {
				item.state = 'play';
				uni.createVideoContext(this.dataList[this.k].articleCode, this).play();
			}
		},
		onDetail() {
			this.showPlan = false;
			this.showDetail = true;
			return;
		},
		// ÂºÄÂßãÂõûÂ§ç
		onReply(res) {
			app.platform.hasLoginToken(() => {
				this.chatData = {
					replyId: res ? res.replyId : 0,
					replyName: res ? res.replyName : '',
					fatherId: res ? res.fatherId : 0,
					focus: true
				}
				console.log(this.chatData);
			})
		},
		onBlur() {
			this.chatData = { ...chat }
			uni.hideKeyboard()
		},
		// Êèê‰∫§ËØÑËÆ∫ÊàñÂõûÂ§ç
		onChatConfirm(content) {
			console.log('ËØÑËÆ∫ÂÜÖÂÆπÔºö', content);
			if (!content) {
				uni.showToast({
					title: "ËØ∑ËæìÂÖ•ËØÑËÆ∫ÂÜÖÂÆπ",
					icon: "none"
				})
				return
			}
			app.platform.hasLoginToken(() => {
				const data = this.chatData;
				const kData = this.dataList[this.k]
				const url = data.replyId == 0 ? `article/comment/issue/${kData.articleCode}` : `article/reply/comment/${data.replyId}`;
				app.http.Post(url, { content }, (res) => {
					kData.comment++;
					uni.$emit('commentChange', { res: res, data: data })
					this.chatData = { ...chat }
					uni.showToast({ title: 'ËØÑËÆ∫ÊàêÂäü', icon: 'none' })
					uni.$emit('informationChange', kData)
				})
			})
		},
		onClosePopup() {
			if (this.chatData.focus) {
				this.onBlur();
				return;
			}
			this.showDetail = false;
			setTimeout(() => { this.showPlan = true }, 250)
		},
		getMoreComment() {
			this.resetLoadmored = true;
			uni.$emit('comloadmore')
		},
		timeFormat(time) {
			return uni.$u.timeFormat(time, 'mmÊúàddÊó• hh:MM')
		}
	}
}
</script>
<style>
.container {
	background-color: #000000;
}

.navigateBox {
	width: 750rpx;
	height: 140rpx;
	position: fixed;
	top: 0px;
	left: 0px;
	right: 0px;
	display: flex;
	align-items: center;
	flex-direction: row;
	justify-content: space-between;
	z-index: 999;
	padding: 0 33rpx 0 13rpx;
}

.navigateBackBox {
	width: 61rpx;
	height: 61rpx;
	display: flex;
	align-items: center;
	flex-direction: row;
	justify-content: center;
}

.navigateBack {
	width: 21rpx;
	height: 38rpx;
}

.navigateShareBox {
	width: 77rpx;
	height: 77rpx;
	display: flex;
	align-items: center;
	flex-direction: row;
	justify-content: center;
	margin-right: -20rpx;
}

.navigateShare {
	width: 37rpx;
	height: 37rpx;
}

.item {
	/* width : 750rpx; */
	background-color: #000000;
	position: relative;
}

.videoHover {
	position: absolute;
	top: 0;
	left: 0;
	flex: 1;
	background-color: rgba(0, 0, 0, 0.1);
	justify-content: center;
	align-items: center;

	/* border-style: dashed;
		border-color: #DD524D;
		border-width: 1px; */
}

.playState {
	width: 160rpx;
	height: 160rpx;
	opacity: 0.2;
}

.userInfo {
	position: absolute;
	bottom: 110px;
	right: 10px;
	flex-direction: column;

}

.userAvatar {
	border-radius: 500%;
	margin-bottom: 15px;
	border-style: solid;
	border-width: 2px;
	border-color: #ffffff;
}

.userAvatar {
	width: 100rpx;
	height: 100rpx;
}

.likeIco,
.shareIco,
.commentIco {
	width: 60rpx;
	height: 60rpx;
	margin-top: 15px;
}

.likeNum,
.commentNum,
.shareTex {
	color: #ffffff;
	font-size: 30rpx;
	text-align: center;
	margin: 5px;
}

.likeNumActive {
	color: red;
}

.content {
	width: 540rpx;
	z-index: 99;
	position: absolute;
	bottom: 40rpx;
	/* justify-content: center; */
	left: 44rpx;
	flex-direction: column;
	justify-content: flex-start;
	color: #ffffff;
}

.descBox {
	width: 540rpx;
	height: 50rpx;
	display: flex;
	flex-direction: row;
	align-items: center;
	justify-content: flex-start;
}

.descAuthor {
	font-size: 27rpx;
	font-family: PingFang SC;
	font-weight: 500;
	color: #FFFFFF;
	margin-left: 14rpx;
}

.userName {
	width: 540rpx;
	font-size: 25rpx;
	color: #ffffff;
	margin-top: 18rpx;
	line-height: 38rpx;
	overflow: hidden;
	text-overflow: ellipsis !important;
	/* Ë∂ÖÂá∫ÈÉ®ÂàÜÁúÅÁï•Âè∑ */
	lines: 1;
}

.words {
	width: 540rpx;
	font-size: 25rpx;
	color: #ffffff;
	line-height: 38rpx;
	overflow: hidden;
	text-overflow: ellipsis !important;
	/* Ë∂ÖÂá∫ÈÉ®ÂàÜÁúÅÁï•Âè∑ */
	lines: 2;
	/* Ë∂ÖÂá∫Âõ∫ÂÆöË°åÊï∞ÊòæÁ§∫ÁúÅÁï•Âè∑ */
}

.root {
	background-color: #000000;
}

.popup {
	width: 750rpx;
	height: 0;
	position: fixed;
	bottom: 0;
	left: 0;
	right: 0;
	z-index: 999;
}

.popup-shadow {
	width: 750rpx;
	position: absolute;
	left: 0;
	bottom: 0;
	background: rgba(0, 0, 0, 0.6);
}

.popup-content {
	width: 750rpx;
	position: absolute;
	left: 0;
	bottom: 0;
	border-top-left-radius: 20rpx;
	border-top-right-radius: 20rpx;
	transition-property: height;
	transition-duration: 0.2s;
	transition-delay: 0s;
	justify-content: space-between;
	transition-timing-function: linear;
	background: #fff;
	padding-left: 40rpx;
	padding-right: 40rpx;
}

.vd-user {
	width: 670rpx;
	display: flex;
	align-items: center;
	flex-direction: row;
	height: 130rpx;
	margin-bottom: 40rpx;
	padding-top: 40rpx;
}

.vd-avatar {
	width: 90rpx;
	height: 90rpx;
	border-radius: 50%;
	margin-right: 28rpx;
}

.vd-name {
	width: 670rpx;
	font-size: 29rpx;
	font-family: PingFang SC;
	font-weight: 600;
	color: #333333;
	margin-bottom: 5rpx;
}

.vd-time {
	width: 670rpx;
	font-size: 23rpx;
	font-family: Microsoft YaHei;
	font-weight: 400;
	color: #7C7C7C;
}

.upslide {
	width: 220rpx;
	height: 400rpx;
	position: fixed;
	left: 265rpx;
	top: 500rpx;
	opacity: 0;
}

.upslide-show {
	opacity: 1;
}

.upslide-name {
	width: 220rpx;
	font-size: 25rpx;
	font-family: PingFang SC;
	font-weight: 400;
	color: #FFFEFE;
	text-align: center;
}

.upslide-pic {
	width: 160rpx;
	height: 324rpx;
	margin-left: 26rpx;
	margin-bottom: 25rpx;
}

.upslide-hand {
	width: 122rpx;
	height: 104rpx;
	position: absolute;
	right: -35rpx;
	top: 193rpx;
}</style>
